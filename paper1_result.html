<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STET 2025 - Paper-I Results</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        
        .result-container { max-width: 900px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); overflow: hidden; }
        
        .result-header { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 30px; text-align: center; position: relative; }
        .result-header h1 { font-size: 28px; margin-bottom: 10px; }
        .result-header p { font-size: 16px; opacity: 0.9; }
        
        /* Language Toggle */
        .language-toggle { position: absolute; top: 20px; right: 30px; display: flex; gap: 8px; align-items: center; }
        .lang-btn { padding: 6px 15px; border: 2px solid white; background: transparent; color: white; border-radius: 15px; cursor: pointer; font-weight: bold; transition: all 0.3s; font-size: 12px; }
        .lang-btn.active { background: white; color: #1e3c72; }
        .lang-btn:hover { transform: scale(1.05); }
        
        .result-body { padding: 40px; }
        
        .candidate-details { background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 30px; }
        .candidate-details h3 { color: #1e3c72; margin-bottom: 15px; font-size: 18px; }
        .detail-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #ddd; }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { font-weight: bold; color: #555; }
        .detail-value { color: #333; }
        
        .score-card { background: linear-gradient(135deg, #4caf50, #45a049); color: white; border-radius: 15px; padding: 40px; text-align: center; margin-bottom: 30px; box-shadow: 0 5px 20px rgba(76, 175, 80, 0.3); }
        .score-card h2 { font-size: 24px; margin-bottom: 20px; }
        .total-score { font-size: 72px; font-weight: bold; margin: 20px 0; }
        .percentage { font-size: 24px; opacity: 0.9; margin-top: 10px; }
        
        .score-details { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px; }
        .score-item { background: rgba(255,255,255,0.2); padding: 20px; border-radius: 10px; }
        .score-item h4 { font-size: 14px; margin-bottom: 10px; opacity: 0.9; }
        .score-item .number { font-size: 36px; font-weight: bold; }
        
        .performance-section { margin-bottom: 30px; }
        .performance-section h3 { color: #1e3c72; margin-bottom: 20px; font-size: 20px; }
        
        .performance-bar { background: #f0f0f0; border-radius: 10px; margin-bottom: 15px; }
        .bar-item { display: flex; align-items: center; padding: 15px; }
        .bar-label { width: 150px; font-weight: bold; color: #333; }
        .bar-visual { flex: 1; height: 30px; border-radius: 5px; position: relative; background: #e0e0e0; overflow: hidden; }
        .bar-fill { height: 100%; border-radius: 5px; transition: width 1s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; color: white; font-weight: bold; font-size: 14px; }
        .bar-fill.correct { background: linear-gradient(90deg, #4caf50, #66bb6a); }
        .bar-fill.wrong { background: linear-gradient(90deg, #f44336, #e57373); }
        .bar-fill.unattempted { background: linear-gradient(90deg, #ff9800, #ffb74d); }
        
        .subject-analysis { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .subject-card { background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea; }
        .subject-card h4 { color: #1e3c72; margin-bottom: 10px; font-size: 16px; }
        .subject-stats { font-size: 14px; color: #666; }
        
        .action-buttons { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 30px; }
        .btn { padding: 15px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #4caf50; color: white; }
        .btn-secondary:hover { background: #45a049; }
        .btn-danger { background: #f44336; color: white; }
        .btn-danger:hover { background: #d32f2f; }
        
        .detailed-analysis { margin-top: 30px; }
        .detailed-analysis h3 { color: #1e3c72; margin-bottom: 20px; font-size: 20px; }
        
        .analysis-filters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 16px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 20px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .filter-btn.active, .filter-btn:hover { background: #667eea; color: white; }
        
        .question-item { background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 15px; border-left: 5px solid #ddd; }
        .question-item.correct { border-left-color: #4caf50; }
        .question-item.wrong { border-left-color: #f44336; }
        .question-item.unattempted { border-left-color: #ff9800; }
        
        .question-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .question-num { font-weight: bold; color: #1e3c72; }
        .question-status { padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: bold; }
        .status-correct { background: #4caf50; color: white; }
        .status-wrong { background: #f44336; color: white; }
        .status-unattempted { background: #ff9800; color: white; }
        
        .question-text { font-size: 16px; color: #333; margin-bottom: 15px; line-height: 1.6; }
        .question-english { margin-bottom: 10px; }
        .question-hindi { color: #555; font-size: 15px; padding-top: 10px; border-top: 1px dashed #ddd; }
        .question-options { display: grid; gap: 10px; }
        .option-item { padding: 10px 15px; border-radius: 5px; display: flex; align-items: center; gap: 10px; }
        .option-item.user-answer { background: #e3f2fd; border: 2px solid #2196f3; }
        .option-item.correct-answer { background: #e8f5e9; border: 2px solid #4caf50; }
        .option-item.wrong-user { background: #ffebee; border: 2px solid #f44336; }
        
        .option-label { font-weight: bold; color: #666; min-width: 20px; }
        .option-text { flex: 1; }
        .option-indicator { font-size: 12px; font-weight: bold; padding: 2px 8px; border-radius: 10px; }
        .indicator-user { background: #2196f3; color: white; }
        .indicator-correct { background: #4caf50; color: white; }
        
        @media print { .action-buttons, .analysis-filters { display: none; } }
        @media (max-width: 768px) { .score-details { grid-template-columns: 1fr; } .total-score { font-size: 48px; } .analysis-filters { justify-content: center; } }
    </style>
</head>
<body>
    <div class="result-container">
        <div class="result-header">
            <div class="language-toggle">
                <span style="color: white; font-size: 12px;">Lang:</span>
                <button class="lang-btn" id="btnEnglish" onclick="setLanguage('english')">Eng</button>
                <button class="lang-btn active" id="btnBoth" onclick="setLanguage('both')">Both</button>
                <button class="lang-btn" id="btnHindi" onclick="setLanguage('hindi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
            </div>
            <h1>üéì BIHAR STET 2025 - Exam Results</h1>
            <p>Paper-I: Social Science (Secondary Level - Class 9-10)</p>
        </div>

        <div class="result-body">
            <div class="candidate-details">
                <h3>üë§ Candidate Information</h3>
                <div class="detail-row">
                    <span class="detail-label">Name:</span>
                    <span class="detail-value" id="candidateName">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Roll Number:</span>
                    <span class="detail-value" id="rollNumber">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Application Number:</span>
                    <span class="detail-value" id="appNumber">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Paper:</span>
                    <span class="detail-value">Paper-I (Social Science)</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Exam Date:</span>
                    <span class="detail-value">14 October 2025</span>
                </div>
            </div>

            <div class="score-card">
                <h2>Your Score</h2>
                <div class="total-score" id="totalScore">0</div>
                <div style="font-size: 18px;">Out of 150</div>
                <div class="percentage" id="percentage">0%</div>
                
                <div class="score-details">
                    <div class="score-item">
                        <h4>Correct Answers</h4>
                        <div class="number" id="correctAnswers">0</div>
                    </div>
                    <div class="score-item">
                        <h4>Wrong Answers</h4>
                        <div class="number" id="wrongAnswers">0</div>
                    </div>
                    <div class="score-item">
                        <h4>Not Answered</h4>
                        <div class="number" id="notAnswered">0</div>
                    </div>
                </div>
            </div>

            <div class="performance-section">
                <h3>üìä Performance Analysis</h3>
                <div class="performance-bar">
                    <div class="bar-item">
                        <div class="bar-label">Correct</div>
                        <div class="bar-visual">
                            <div class="bar-fill correct" id="correctBar" style="width: 0%;">0%</div>
                        </div>
                    </div>
                </div>
                <div class="performance-bar">
                    <div class="bar-item">
                        <div class="bar-label">Wrong</div>
                        <div class="bar-visual">
                            <div class="bar-fill wrong" id="wrongBar" style="width: 0%;">0%</div>
                        </div>
                    </div>
                </div>
                <div class="performance-bar">
                    <div class="bar-item">
                        <div class="bar-label">Unattempted</div>
                        <div class="bar-visual">
                            <div class="bar-fill unattempted" id="unattemptedBar" style="width: 0%;">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="performance-section">
                <h3>üìö Subject-wise Breakdown</h3>
                <div class="subject-analysis">
                    <div class="subject-card">
                        <h4>History</h4>
                        <div class="subject-stats">Total Questions: 25</div>
                    </div>
                    <div class="subject-card">
                        <h4>Geography</h4>
                        <div class="subject-stats">Total Questions: 25</div>
                    </div>
                    <div class="subject-card">
                        <h4>Civics</h4>
                        <div class="subject-stats">Total Questions: 25</div>
                    </div>
                    <div class="subject-card">
                        <h4>Economics</h4>
                        <div class="subject-stats">Total Questions: 25</div>
                    </div>
                    <div class="subject-card">
                        <h4>Pedagogy & Others</h4>
                        <div class="subject-stats">Total Questions: 50</div>
                    </div>
                </div>
            </div>

            <div class="detailed-analysis" id="detailedAnalysis" style="display: none;">
                <h3>üìã Detailed Question Analysis</h3>
                <div class="analysis-filters">
                    <button class="filter-btn active" onclick="filterQuestions('all')">All Questions</button>
                    <button class="filter-btn" onclick="filterQuestions('correct')">Correct</button>
                    <button class="filter-btn" onclick="filterQuestions('wrong')">Wrong</button>
                    <button class="filter-btn" onclick="filterQuestions('unattempted')">Unattempted</button>
                </div>
                <div class="questions-container" id="questionsContainer"></div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="toggleDetailedAnalysis()">üìä View Detailed Analysis</button>
                <button class="btn btn-primary" onclick="exportPDF()">üìÑ Export PDF</button>
                <button class="btn btn-secondary" onclick="goToPaperSelection()">üìù Take Another Paper</button>
                <button class="btn btn-danger" onclick="logout()">üö™ Logout</button>
            </div>
        </div>
    </div>

    <script src="paper1_questions.js"></script>
    <script src="paper1_new_set_questions.js"></script>
    <script src="paper1set3.js"></script>
    <script>
        if (sessionStorage.getItem('loggedIn') !== 'true') {
            alert('Please login first!');
            window.location.href = 'stet_login.html';
        }

        document.getElementById('candidateName').textContent = sessionStorage.getItem('candidateName');
        document.getElementById('rollNumber').textContent = sessionStorage.getItem('rollNumber');
        document.getElementById('appNumber').textContent = sessionStorage.getItem('applicationNumber');

        const correct = parseInt(sessionStorage.getItem('paper1Correct') || 0);
        const wrong = parseInt(sessionStorage.getItem('paper1Wrong') || 0);
        const notAnswered = parseInt(sessionStorage.getItem('paper1NotAnswered') || 0);
        const total = 150;

        document.getElementById('totalScore').textContent = correct;
        document.getElementById('correctAnswers').textContent = correct;
        document.getElementById('wrongAnswers').textContent = wrong;
        document.getElementById('notAnswered').textContent = notAnswered;

        const percentage = ((correct / total) * 100).toFixed(2);
        document.getElementById('percentage').textContent = percentage + '%';

        const correctPercent = ((correct / total) * 100).toFixed(1);
        const wrongPercent = ((wrong / total) * 100).toFixed(1);
        const unattemptedPercent = ((notAnswered / total) * 100).toFixed(1);

        setTimeout(() => {
            document.getElementById('correctBar').style.width = correctPercent + '%';
            document.getElementById('correctBar').textContent = correctPercent + '%';
            
            document.getElementById('wrongBar').style.width = wrongPercent + '%';
            document.getElementById('wrongBar').textContent = wrongPercent + '%';
            
            document.getElementById('unattemptedBar').style.width = unattemptedPercent + '%';
            document.getElementById('unattemptedBar').textContent = unattemptedPercent + '%';
        }, 500);

        function goToPaperSelection() {
            window.location.href = 'paper_selection.html';
        }

        let currentFilter = 'all';
        let detailedAnalysisVisible = false;
        let languageMode = sessionStorage.getItem('resultLanguageMode') || 'both';
        
        // Set initial language mode
        document.addEventListener('DOMContentLoaded', function() {
            setLanguage(languageMode);
        });
        
        function setLanguage(lang) {
            languageMode = lang;
            sessionStorage.setItem('resultLanguageMode', lang);
            
            // Update button states
            document.getElementById('btnEnglish').classList.remove('active');
            document.getElementById('btnHindi').classList.remove('active');
            document.getElementById('btnBoth').classList.remove('active');
            document.getElementById('btn' + lang.charAt(0).toUpperCase() + lang.slice(1)).classList.add('active');
            
            // Reload detailed analysis if visible
            if (detailedAnalysisVisible) {
                loadDetailedAnalysis();
            }
        }
        
        function toggleDetailedAnalysis() {
            const analysisDiv = document.getElementById('detailedAnalysis');
            const btn = event.target;
            
            if (detailedAnalysisVisible) {
                analysisDiv.style.display = 'none';
                btn.textContent = 'üìä View Detailed Analysis';
                detailedAnalysisVisible = false;
            } else {
                loadDetailedAnalysis();
                analysisDiv.style.display = 'block';
                btn.textContent = 'üìä Hide Detailed Analysis';
                detailedAnalysisVisible = true;
            }
        }
        
        function loadDetailedAnalysis() {
            const userAnswers = JSON.parse(sessionStorage.getItem('paper1UserAnswers') || '{}');
            const questionsContainer = document.getElementById('questionsContainer');
            
            // Use saved question bank from localStorage (preserves shuffle order)
            const savedBank = localStorage.getItem(`paper1QuestionBank_${sessionStorage.getItem('sessionId')}`);
            let questionBank;
            
            if (savedBank) {
                questionBank = JSON.parse(savedBank);
            } else {
                questionsContainer.innerHTML = '<p>Question data not available. Please retake the exam.</p>';
                return;
            }
            
            if (!questionBank || questionBank.length === 0) {
                questionsContainer.innerHTML = '<p>Question data not available. Please retake the exam.</p>';
                return;
            }
            
            questionsContainer.innerHTML = '';
            
            questionBank.forEach((question, index) => {
                const userAnswer = userAnswers[question.id];
                const isCorrect = userAnswer === question.correct;
                const isAttempted = userAnswer !== undefined;
                
                let status, statusClass;
                if (!isAttempted) {
                    status = 'Unattempted';
                    statusClass = 'unattempted';
                } else if (isCorrect) {
                    status = 'Correct';
                    statusClass = 'correct';
                } else {
                    status = 'Wrong';
                    statusClass = 'wrong';
                }
                
                const questionDiv = document.createElement('div');
                questionDiv.className = `question-item ${statusClass}`;
                questionDiv.setAttribute('data-status', statusClass);
                
                let questionTextHtml = '';
                if (languageMode === 'english') {
                    questionTextHtml = `<div class="question-english">${question.question}</div>`;
                } else if (languageMode === 'hindi') {
                    questionTextHtml = `<div class="question-hindi">${question.questionHindi || question.question}</div>`;
                } else {
                    questionTextHtml = `<div class="question-english">${question.question}</div><div class="question-hindi">${question.questionHindi || ''}</div>`;
                }
                
                questionDiv.innerHTML = `
                    <div class="question-header">
                        <span class="question-num">Question ${index + 1}</span>
                        <span class="question-status status-${statusClass}">${status}</span>
                    </div>
                    <div class="question-text">${questionTextHtml}</div>
                    <div class="question-options">
                        ${question.options.map((option, optIndex) => {
                            let optionClass = 'option-item';
                            let indicator = '';
                            
                            if (optIndex === question.correct) {
                                optionClass += ' correct-answer';
                                indicator = '<span class="option-indicator indicator-correct">Correct</span>';
                            }
                            
                            if (userAnswer === optIndex) {
                                if (optIndex === question.correct) {
                                    optionClass = 'option-item user-answer correct-answer';
                                } else {
                                    optionClass = 'option-item wrong-user';
                                    indicator = '<span class="option-indicator indicator-user">Your Answer</span>';
                                }
                            }
                            
                            return `
                                <div class="${optionClass}">
                                    <span class="option-label">${String.fromCharCode(65 + optIndex)}.</span>
                                    <span class="option-text">${option}</span>
                                    ${indicator}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                questionsContainer.appendChild(questionDiv);
            });
            
            filterQuestions(currentFilter);
        }
        
        function filterQuestions(filter) {
            currentFilter = filter;
            const questions = document.querySelectorAll('.question-item');
            const filterBtns = document.querySelectorAll('.filter-btn');
            
            filterBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            questions.forEach(question => {
                const status = question.getAttribute('data-status');
                if (filter === 'all' || status === filter) {
                    question.style.display = 'block';
                } else {
                    question.style.display = 'none';
                }
            });
        }
        
        function exportPDF() {
            const name = sessionStorage.getItem('candidateName') || 'Candidate';
            const roll = sessionStorage.getItem('rollNumber') || 'N/A';
            document.title = `STET_Paper1_${name}_${roll}`;
            window.print();
        }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                sessionStorage.clear();
                window.location.href = 'stet_login.html';
            }
        }
    </script>
</body>
</html>
